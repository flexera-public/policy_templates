name "Azure Usage Report - Instance Time Used"
rs_pt_ver 20180301
type "policy"
short_description "This policy produces a usage report showing the amount of time used for each Azure Virtual Machine/Instance Family. See the [README](https://github.com/flexera-public/policy_templates/tree/master/operational/azure/total_instance_usage_report) and [docs.flexera.com/flexera/EN/Automation](https://docs.flexera.com/flexera/EN/Automation/AutomationGS.htm) to learn more."
long_description ""
severity "low"
category "Operational"
default_frequency "monthly"
info(
  version: "1.0.0",
  provider: "Azure",
  service: "Compute",
  policy_set: "Usage Report"
)

###############################################################################
# Parameters
###############################################################################

parameter "param_email" do
  type "list"
  category "Policy Settings"
  label "Email Addresses"
  description "Email addresses of the recipients you wish to notify."
  default []
end

parameter "param_months_back" do
  type "number"
  category "Policy Settings"
  label "Months Back"
  description "How many months to go back in the chart/incident."
  min_value 1
  max_value 12
  default 12
end

parameter "param_unit_instance" do
  type "string"
  category "Policy Settings"
  label "Instance Unit"
  description "Instance unit to normalize usage against. See README for more details."
  allowed_values "Normalized Units (NFUs)", "vCPUs", "Memory (GiB)"
  default "Normalized Units (NFUs)"
end

parameter "param_unit_time" do
  type "string"
  category "Policy Settings"
  label "Time Unit"
  description "Unit of time to use for results. See README for more details."
  allowed_values "Hours", "Days", "Weeks", "Months", "Years"
  default "Hours"
end

parameter "param_regions_allow_or_deny" do
  type "string"
  category "Filters"
  label "Allow/Deny Regions"
  description "Allow or Deny entered regions."
  allowed_values "Allow", "Deny"
  default "Allow"
end

parameter "param_regions_list" do
  type "list"
  category "Filters"
  label "Allow/Deny Regions List"
  description "A list of allowed or denied regions. Example: 'US West (Oregon)'. Leave blank to check all regions."
  default []
end

parameter "param_bc_allow_or_deny" do
  type "string"
  category "Filters"
  label "Allow/Deny Billing Centers"
  description "Allow or Deny entered Billing Centers."
  allowed_values "Allow", "Deny"
  default "Allow"
end

parameter "param_bc_list" do
  type "list"
  category "Filters"
  label "Allow/Deny Billing Center List"
  description "A list of allowed or denied Billing Center names/IDs. Leave blank to check all Billing Centers."
  default []
end

###############################################################################
# Authentication
###############################################################################

credentials "auth_flexera" do
  schemes "oauth2"
  label "Flexera"
  description "Select Flexera One OAuth2 credentials"
  tags "provider=flexera"
end


