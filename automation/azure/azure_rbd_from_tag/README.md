# Azure Rule-Based Dimension From Subscription Tags

## What It Does

This policy template creates and updates custom Rule-Based Dimensions that surface the specified Azure Subscription tag keys in the Flexera One platform. This allows costs to be sliced by the values of the tag keys in question. Rules added to these rule-based dimensions manually, or by other policy templates, will not be deleted.

NOTE: If applying this policy template multiple times for multiple Azure tenants, please give each applied policy a distinct name. This is to ensure the policy templates do not overwrite each other's work.

NOTE: If updating from a version of this policy template prior to version 2.0, it is recommended that you delete any existing rule-based dimensions generated by this policy template before applying it again.

## Input Parameters

This policy has the following input parameters required when launching the policy.

- *Effective Date* - The month and year in YYYY-MM format that you want the rules to apply. This should be left at its default value in most cases to ensure that the rules apply to all costs, including historical costs.
- *Tag Keys* - A list of Azure Subscription tag keys to build Rule-Based Dimensions from. Multiple tags can be specified for a single dimension by placing a single entry with each tag key separated by a semicolon (;) character. For example, a value of `env;environment;environ` will create one Rule-Based Dimension that checks the keys "env", "environment", and "environ" for values.
- *Dimension Names* - A list of names to give the Rule-Based Dimensions in the Flexera platform. Enter names in the same order as the tag keys in the `Tag Keys` field. Dimension names will be derived from tag keys directly if this list is left empty.
- *Lowercase Values* - Whether or not to normalize all values by converting them to lowercase. Note that, if the same value appears multiple times with different casing, and this option is disabled, the rule-based dimension will be rejected and this policy template will fail.

## Policy Actions

- Create/update rule-based dimensions

## Prerequisites

This Policy Template uses [Credentials](https://docs.flexera.com/flexera/EN/Automation/ManagingCredentialsExternal.htm) for authenticating to datasources -- in order to apply this policy you must have a Credential registered in the system that is compatible with this policy. If there are no Credentials listed when you apply the policy, please contact your Flexera Org Admin and ask them to register a Credential that is compatible with this policy. The information below should be consulted when creating the credential(s).

- [**Azure Resource Manager Credential**](https://docs.flexera.com/flexera/EN/Automation/ProviderCredentials.htm#automationadmin_109256743_1124668) (*provider=azure_rm*) which has the following permissions:
  - `Microsoft.Resources/subscriptions/resources/read`
  - `Microsoft.Resources/subscriptions/providers/read`
  - `Microsoft.Resources/tags/read`

- [**Flexera Credential**](https://docs.flexera.com/flexera/EN/Automation/ProviderCredentials.htm) (*provider=flexera*) which has the following roles:
  - `observer`
  - `billing_center_viewer`
  - `rule_based_dimensions_manager`

The [Provider-Specific Credentials](https://docs.flexera.com/flexera/EN/Automation/ProviderCredentials.htm) page in the docs has detailed instructions for setting up Credentials for the most common providers.

## Supported Clouds

- Azure

## Cost

This policy template does not incur any cloud costs.
