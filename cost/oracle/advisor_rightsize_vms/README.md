# Oracle Cloud Advisor: Rightsize Virtual Machines

## What It Does

This policy template reports on any existing underutilized virtual machine recommendations generated by Oracle Cloud Advisor. Optionally, this report can be emailed.

### How It Works

This policy template reports the following Oracle Cloud Advisor recommendations:

- `cost-management-compute-host-underutilized`: Checks if a virtual machine is underutilized and recommends a more appropriate machine type when appropriate.
- `cost-management-compute-host-idle`: Checks if a virtual machine is idle and recommends termination when appropriate.

More information on Cloud Advisor is available in Oracle's documentation:

- [About Cloud Advisor](https://docs.public.oneportal.content.oci.oraclecloud.com/en-us/iaas/Content/CloudAdvisor/Concepts/cloudadvisoroverview.htm)
- [Getting Started with Cloud Advisor](https://docs.oracle.com/en-us/iaas/Content/CloudAdvisor/Tasks/cloudadvisor-getting_started.htm)

### Policy Savings Details

The policy includes the estimated monthly savings. The estimated monthly savings is recognized for underutilized resources if the resource is downsized.

- The `Estimated Monthly Savings` is obtained directly from the Oracle Cloud Advisor service.
- Since the savings estimates are obtained directly from Oracle, they will take into account any cloud provider discounts but *not* any Flexera adjustment rules or other cost manipulations specific to the Flexera platform. They will also be in whatever currency you've configured your Oracle Cloud environment to use.
- The incident message detail includes the sum of each resource `Estimated Monthly Savings` as `Potential Monthly Savings`.

## Input Parameters

- *Email Addresses* - Email addresses of the recipients you wish to notify.
- *Oracle Cloud Root Compartment OCID* - The OCID of the Oracle Cloud root compartment.
- *Primary Oracle Cloud Region* - Primary Oracle Cloud region. Example: us-phoenix-1
- *Minimum Savings Threshold* - Minimum potential savings required to generate a recommendation.
- *Allow/Deny Regions* - Whether to treat Allow/Deny Regions List parameter as allow or deny list. Has no effect if Allow/Deny Regions List is left empty.
- *Allow/Deny Regions List* - Filter results by region, either only allowing this list or denying it depending on how the above parameter is set. Leave blank to consider all the regions.
- *Report Idle or Underutilized* - Whether to report on idle VM instances, underutilized VM instances, or both. If both are selected, VM instances raised in the idle VM instances incident will never appear in the underutilized VM instances incident.
- *Preserve Boot Volume* - Whether to preserve the boot volume when terminating virtual machines. Note that savings won't be fully realized unless the boot volume is also deleted.
- *Preserve Data Volumes* - Whether to preserve the data volumes that were created at launch when terminating virtual machines.
- *Automatic Actions* - When this value is set, this policy will automatically take the selected action(s).

Please note that the "Automatic Actions" parameter contains a list of action(s) that can be performed on the resources. When it is selected, the policy will automatically execute the corresponding action on the data that failed the checks, post incident generation. Please leave it blank for *manual* action.
For example if a user selects the "Terminate Idle Instances" action while applying the policy, all the resources that didn't satisfy the policy condition will be terminated.

## Policy Actions

The following policy actions are taken on any resources found to be out of compliance.

- Send an email report

## Prerequisites

This Policy Template uses [Credentials](https://docs.flexera.com/flexera/EN/Automation/ManagingCredentialsExternal.htm) for authenticating to datasources -- in order to apply this policy you must have a Credential registered in the system that is compatible with this policy. If there are no Credentials listed when you apply the policy, please contact your Flexera Org Admin and ask them to register a Credential that is compatible with this policy. The information below should be consulted when creating the credential(s).

- [**Oracle Credential**](https://docs.flexera.com/flexera/EN/Automation/ProviderCredentials.htm#automationadmin_3335267112_1121578) (*provider=oracle*) which meets the below requirements:
  - Allow group [Group] to read optimizer-api-family in tenancy
    - [Group] should be replaced with a group that the user associated with the Oracle Cloud credential is a member of.

- [**Flexera Credential**](https://docs.flexera.com/flexera/EN/Automation/ProviderCredentials.htm) (*provider=flexera*) which has the following roles:
  - `billing_center_viewer`

The [Provider-Specific Credentials](https://docs.flexera.com/flexera/EN/Automation/ProviderCredentials.htm) page in the docs has detailed instructions for setting up Credentials for the most common providers.

Additionally, this Policy Template requires that [Oracle Cloud Advisor be enabled](https://docs.oracle.com/en-us/iaas/Content/CloudAdvisor/Tasks/cloudadvisor-getting_started.htm) in your Oracle Cloud environment.

## Supported Clouds

- Oracle

## Cost

This policy template does not incur any cloud costs.
