# Google Committed Use Discount Recommender

## What It Does

This Policy Template reports any Committed Use Discount Recommendations generated by Google. The user can adjust which recommendations are reported via policy parameters.

## How It Works

Recommendations are obtained via requests to the [Google Recommender API](https://cloud.google.com/docs/cuds-recommender?hl=en).

### Policy Savings Details

The policy template includes the estimated savings. The estimated savings is recognized if the recommended CUD is purchased. The savings values are provided directly by the [Google Recommender API](https://cloud.google.com/docs/cuds-recommender?hl=en).

If the Flexera organization is configured to use a currency other than the one the [Google Recommender API](https://cloud.google.com/docs/cuds-recommender?hl=en) returns, the savings values will be converted using the exchange rate at the time that the policy executes.

## Input Parameters

This policy template has the following input parameters:

- *Email Addresses* - Email addresses of the recipients you wish to notify.
- *Minimum Savings Threshold* - Minimum potential savings required to generate a recommendation.
- *Allow/Deny Projects* - Whether to treat Allow/Deny Projects List parameter as allow or deny list. Has no effect if Allow/Deny Projects List is left empty.
- *Allow/Deny Projects List* - Filter results by project ID/name, either only allowing this list or denying it depending on how the above parameter is set. Leave blank to consider all projects
- *Ignore System Projects* - Whether or not to automatically ignore system projects e.g. projects whose id begins with `sys-`
- *Ignore Google Apps Script Projects* - Whether or not to automatically ignore Google Apps Script projects e.g. projects whose id begins with `app-`
- *Allow/Deny Regions* - Whether to treat Allow/Deny Regions List parameter as allow or deny list. Has no effect if Allow/Deny Regions List is left empty.
- *Allow/Deny Regions List* - Filter results by region, either only allowing this list or denying it depending on how the above parameter is set. Leave blank to consider all the regions.
- *Term* - Length of CUD term to provide recommendations for. Can be set to either `1 Year` or `3 Year`
- *Recommendation Algorithm* - The algorithm to use for generating recommendations. Can be set to either `Optimal` or `Stable Usage`.
  - `Stable Usage` covers minimum stable usage over time.
  - `Optimal` is are based on overall usage and might cover resources that are not active all the time.
  - See [Google's documentation](https://cloud.google.com/docs/cuds-recommender?hl=en#understanding-recommendations) for more information.

## Policy Actions

The following policy actions are taken for any recommendations:

- Send an email report

## Prerequisites

This Policy Template uses [Credentials](https://docs.flexera.com/flexera/EN/Automation/ManagingCredentialsExternal.htm) for authenticating to datasources -- in order to apply this policy template you must have a Credential registered in the system that is compatible with this policy template. If there are no Credentials listed when you apply the policy template, please contact your Flexera Org Admin and ask them to register a Credential that is compatible with this policy template. The information below should be consulted when creating the credential(s).

- [**Google Cloud Credential**](https://docs.flexera.com/flexera/EN/Automation/ProviderCredentials.htm#automationadmin_4083446696_1121577) (*provider=gce*) which has the following:
  - `resourcemanager.projects.get`
  - `compute.regions.list`
  - `recommender.usageCommitmentRecommendations.list`
  - `billing.resourceCosts.get`*
  - `billing.accounts.getSpendingInformation`*

  \* Needed for recommendations to reflect custom contract pricing. Otherwise, recommendations will use list pricing.

- [**Flexera Credential**](https://docs.flexera.com/flexera/EN/Automation/ProviderCredentials.htm) (*provider=flexera*) which has the following roles:
  - `billing_center_viewer`

The [Provider-Specific Credentials](https://docs.flexera.com/flexera/EN/Automation/ProviderCredentials.htm) page in the docs has detailed instructions for setting up Credentials for the most common providers.

Additionally, this policy template requires that several APIs be enabled in your Google Cloud environment:

- [Cloud Resource Manager API](https://console.cloud.google.com/flows/enableapi?apiid=cloudresourcemanager.googleapis.com)
- [Recommender API](https://console.cloud.google.com/flows/enableapi?apiid=recommender.googleapis.com)

## Supported Clouds

- Google

## Cost

This policy template does not incur any cloud costs.

### API Quotas

Google sets quotas on the Recommender API; this will cause a `429 RESOURCE_EXHAUSTED` response when the quota is exceeded. See [Quotas & Limits](https://cloud.google.com/recommender/quotas?hl=en) for more information.
