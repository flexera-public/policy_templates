## AWS Reserved Instances Recommendation Policy Template

## NOTE: These RI Purchase Recommendations are generated by AWS. This policy will raise incidents based on those recommendations.

**As a best practice, this policy should only be applied to the Master Account, and not to each individual RightScale Account.**

### What it does
This Policy Template leverages the [AWS Cost Explorer API](https://docs.aws.amazon.com/aws-cost-management/latest/APIReference/API_GetReservationPurchaseRecommendation.html). It will raise incidents if AWS has any RI Purchase Recommendations, whose net savings exceeds the *Net Savings Threshold* parameter in the Policy.

It will email the user specified in `Email addresses of the recipients you wish to notify`

### Prerequesites

- The following RightScale Credentials
  - `AWS_ACCESS_KEY_ID` - The Access Key of an IAM User in the Master Payer account, which has access to Cost Explorer.
  - `AWS_SECRET_ACCESS_KEY` - The Secret Access Key of the IAM User.

### Input Parameters

This policy has the following input parameters required when launching the policy.

- *Look Back Period* - Specify the number of days of past usage to analyze.
- *Service* - Specify the AWS Service for which to search for RIs
- *EC2 Specification* - If the Service is "EC2", specify whether to look for Standard or Convertible RIs.  For Services besides EC2, this parameter will be ignored.
- *RI Term* - Specify he Term length for the RI.
- *Payment Option* - Optionally, specify the payment option for this RI.
- *Net Savings Threshold* - Specify the minimum Net Savings that should result in an RI purchase recommendation
- *Email addresses to notify* - A list of email addresses to notify

### Policy Actions

The following policy actions are taken on any resources found to be out of compliance.

- Send an email report

### Required RightScale Roles

- Cloud Management - Actor
- Cloud Management - Observer
- Cloud Management - credential_viewer

### AWS Required Permissions

This policy requires permissions to describe AWS Cost Explorer.
The Cloud Management Platform automatically creates two Credentials when connecting AWS to Cloud Management; AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY. The IAM user credentials contained in those credentials will require the following permissions:

```javascript
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ce:*"
      ],
      "Resource": [
        "*"
      ]
    }
  ]
}
```

### Supported Clouds

- AWS

### Cost

This Policy Template does not launch any instances, and so does not incur any cloud costs.
