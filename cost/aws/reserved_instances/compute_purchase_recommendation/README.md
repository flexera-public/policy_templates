# AWS Reserved Instances Recommendations with Purchase

## Deprecated

This policy is no longer being updated.

## What it does

This Policy Template will send an email notifications when AWS RI Recommendations are identified and allows the user the make RI purchases after approval. NOTE: These RI Purchase Recommendations are generated by AWS.

It will email the user specified in `Email addresses of the recipients you wish to notify`

## Input Parameters

This policy has the following input parameters required when launching the policy.

- *Look Back Period* - Specify the number of days of past usage to analyze.
- *Service* - Specify the AWS Service for which to search for RIs
- *EC2 Specification* - If the Service is "EC2", specify whether to look for Standard or Convertible RIs.  For Services besides EC2, this parameter will be ignored.
- *RI Term* - Specify he Term length for the RI.
- *Payment Option* - Optionally, specify the payment option for this RI.
- *Net Savings Threshold* - Specify the minimum Net Savings that should result in an RI purchase recommendation
- *Email addresses to notify* - A list of email addresses to notify

## Policy Actions

The following policy actions are taken on any resources found to be out of compliance.

- Send an email report
- (Optional) Retrieve RI Purchase Offerings and Execute RI Purchases, after approval

## Required RightScale Roles

- Cloud Management - Actor
- Cloud Management - Observer
- Cloud Management - credential_viewer

## Prerequisites

This Policy Template uses [Credentials](https://docs.flexera.com/flexera/EN/Automation/ManagingCredentialsExternal.htm) for authenticating to datasources -- in order to apply this policy you must have a Credential registered in the system that is compatible with this policy. If there are no Credentials listed when you apply the policy, please contact your Flexera Org Admin and ask them to register a Credential that is compatible with this policy. The information below should be consulted when creating the credential(s).

- [**AWS Credential**](https://docs.flexera.com/flexera/EN/Automation/ProviderCredentials.htm#automationadmin_1982464505_1121575) (*provider=aws*) which has the following permissions:
  - `ce:GetReservationPurchaseRecommendation`
  - `ec2:DescribeReservedInstancesOfferings`
  - `ec2:PurchaseReservedInstancesOffering`

  Example IAM Permission Policy:

  ```json
  {
      "Version": "2012-10-17",
      "Statement": [
          {
              "Effect": "Allow",
              "Action": [
                  "ce:GetReservationPurchaseRecommendation",
                  "ec2:DescribeReservedInstancesOfferings",
                  "ec2:PurchaseReservedInstancesOffering"
              ],
              "Resource": "*"
          }
      ]
  }
  ```

## Supported Clouds

- AWS

## Cost

This Policy Template does not launch any instances, and so does not incur any cloud costs.
